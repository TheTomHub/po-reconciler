<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PO Reconciler</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
  <div id="app">
    <header>
      <h1>PO Reconciliation</h1>
    </header>

    <main>
      <!-- Step 1: Upload PO -->
      <section class="step" id="step-po">
        <div class="step-header">
          <span class="step-number">1</span>
          <span class="step-title">Upload Customer PO</span>
        </div>
        <div class="step-body">
          <label class="file-upload-btn" for="po-file-input">
            Choose File
          </label>
          <input type="file" id="po-file-input" accept=".xlsx,.xls,.csv,.pdf" hidden>
          <span class="status" id="po-status">No file selected</span>
        </div>
        <!-- Manual column selection (hidden by default) -->
        <div id="manual-columns-po" class="manual-columns" hidden>
          <p class="warning-text">Could not auto-detect columns. Please select:</p>
          <div class="select-row">
            <label for="po-sku-col">SKU Column:</label>
            <select id="po-sku-col"></select>
          </div>
          <div class="select-row">
            <label for="po-price-col">Price Column:</label>
            <select id="po-price-col"></select>
          </div>
          <div class="select-row">
            <label for="po-name-col">Name Column (optional):</label>
            <select id="po-name-col"><option value="">— None —</option></select>
          </div>
          <button id="apply-po-columns" class="btn btn-sm">Apply</button>
        </div>
      </section>

      <!-- Step 2: Select ERP Data -->
      <section class="step" id="step-erp">
        <div class="step-header">
          <span class="step-number">2</span>
          <span class="step-title">Select ERP Data</span>
        </div>
        <div class="step-body" id="erp-range-body">
          <button id="select-range-btn" class="btn">Select Range</button>
          <span class="status" id="erp-status">No range selected</span>
        </div>
        <!-- Manual column selection for ERP -->
        <div id="manual-columns-erp" class="manual-columns" hidden>
          <p class="warning-text">Could not auto-detect columns. Please select:</p>
          <div class="select-row">
            <label for="erp-sku-col">SKU Column:</label>
            <select id="erp-sku-col"></select>
          </div>
          <div class="select-row">
            <label for="erp-price-col">Price Column:</label>
            <select id="erp-price-col"></select>
          </div>
          <div class="select-row">
            <label for="erp-name-col">Name Column (optional):</label>
            <select id="erp-name-col"><option value="">— None —</option></select>
          </div>
          <button id="apply-erp-columns" class="btn btn-sm">Apply</button>
        </div>
      </section>

      <!-- Settings -->
      <section class="step" id="step-settings">
        <div class="step-header">
          <span class="step-number">&#9881;</span>
          <span class="step-title">Settings</span>
        </div>
        <div class="step-body">
          <label for="tolerance-input">Tolerance ($):</label>
          <input type="number" id="tolerance-input" value="0.02" min="0" step="0.01">
        </div>
      </section>

      <!-- Reconcile Button -->
      <div class="action-section">
        <button id="reconcile-btn" class="btn btn-primary" disabled>Reconcile</button>
      </div>

      <!-- Progress -->
      <div id="progress-section" hidden>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <span class="progress-text" id="progress-text">Processing...</span>
      </div>

      <!-- Results Summary -->
      <section id="results-section" hidden>
        <h2>Results</h2>
        <div class="results-grid">
          <div class="result-card">
            <span class="result-label">Total Items</span>
            <span class="result-value" id="result-total">—</span>
          </div>
          <div class="result-card match">
            <span class="result-label">Matches</span>
            <span class="result-value" id="result-matches">—</span>
          </div>
          <div class="result-card tolerance">
            <span class="result-label">Within Tolerance</span>
            <span class="result-value" id="result-tolerances">—</span>
          </div>
          <div class="result-card exception">
            <span class="result-label">Exceptions</span>
            <span class="result-value" id="result-exceptions">—</span>
          </div>
          <div class="result-card exposure">
            <span class="result-label">Total Exposure</span>
            <span class="result-value" id="result-exposure">—</span>
          </div>
        </div>
        <div class="action-section">
          <button id="email-btn" class="btn btn-secondary">Email MDC Team</button>
        </div>
      </section>

      <!-- Email Draft -->
      <section id="email-section" hidden>
        <h2>Email Draft</h2>
        <pre id="email-draft"></pre>
        <div class="email-actions">
          <button id="copy-email-btn" class="btn btn-sm">Copy to Clipboard</button>
          <a id="mailto-link" class="btn btn-sm btn-secondary" href="#">Open Email Client</a>
        </div>
        <span class="status" id="email-status"></span>
      </section>

      <!-- Browser preview: results table -->
      <section id="browser-results-table" hidden>
        <h2>Reconciliation Detail</h2>
        <div class="table-scroll">
          <table id="results-table"></table>
        </div>
      </section>

      <!-- Error Display -->
      <div id="error-section" hidden>
        <p class="error-text" id="error-message"></p>
      </div>
    </main>
  </div>
</body>
</html>
